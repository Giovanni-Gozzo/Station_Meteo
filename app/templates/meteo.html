<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Stations M√©t√©o - Derniers relev√©s</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <h1>üå§Ô∏è Derniers relev√©s m√©t√©o D√©taill√©s</h1>

    <div class="filter-container">
        <label for="station_filter">Filtrer par Station ID :</label>
        <select id="station_filter" onchange="filterTable()">
            <option value="all">-- Toutes les stations --</option>
            {% for id in unique_station_ids %}
            <option value="{{ id }}">{{ id }}</option>
            {% endfor %}
        </select>
    </div>

    {% if meteo_data %}
    <table id="meteo-table">
        <thead>
            <tr>
                <th>
                    <a
                        href="{{ url_for('show_meteo_data', sort='date', order='asc' if sort_by == 'date' and order == 'desc' else 'desc', station_id=selected_station_ids) }}">
                        Date
                        {% if sort_by == 'date' %}<span class="sort-indicator">{% if order == 'desc' %} ‚Üì {% else %} ‚Üë
                            {% endif %}</span>{% endif %}
                    </a>
                </th>
                <th>
                    <a
                        href="{{ url_for('show_meteo_data', sort='station_id', order='desc' if sort_by == 'station_id' and order == 'asc' else 'asc', station_id=selected_station_ids) }}">
                        ID Station
                        {% if sort_by == 'station_id' %}<span class="sort-indicator">{% if order == 'asc' %} ‚Üë {% else
                            %} ‚Üì {% endif %}</span>{% endif %}
                    </a>
                </th>
                <th>
                    <a
                        href="{{ url_for('show_meteo_data', sort='ville', order='desc' if sort_by == 'ville' and order == 'asc' else 'asc', station_id=selected_station_ids) }}">
                        Ville
                        {% if sort_by == 'ville' %}<span class="sort-indicator">{% if order == 'asc' %} ‚Üë {% else %} ‚Üì
                            {% endif %}</span>{% endif %}
                    </a>
                </th>

                <th class="data-header">Temp. (¬∞C)</th>
                <th class="data-header">Hum. (%)</th>
                <th class="data-header">Press. (hPa)</th>

                <th class="data-header">Pluie Max (mm/h)</th>
                <th class="data-header">Pluie Cumul (mm)</th>

                <th class="data-header">Force Vent Moy (km/h)</th>
                <th class="data-header">Force Rafale Max (km/h)</th>
                <th class="data-header">Dir. Vent Moy (¬∞)</th>
            </tr>
        </thead>
        <tbody>
            {% for m in meteo_data %}
            <tr class="meteo-row" data-station="{{ m.get_station().get_station_id() }}">
                <td>{{ m.formatted_date() }}</td>
                <td>{{ m.get_station().get_station_id() }}</td>
                <td>{{ m.get_station().get_ville() }}</td>

                <td>{{ m.formatted_temp() }}</td>
                <td>{{ m.formatted_humidity() }}</td>
                <td>{{ m.formatted_pressure() }}</td>

                <td>{{ m.get_pluie().get_pluie_intensite_max() }}</td>
                <td>{{ m.get_pluie().get_pluie() }}</td>

                <td>{{ m.formatted_wind() }}</td>
                <td>{{ m.get_vent().get_force_rafale_max() }}</td>
                <td>{{ m.get_vent().get_direction_du_vecteur_vent_moyen() }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function filterTable() {
            var input = document.getElementById("station_filter");
            var filter = input.value;
            var rows = document.querySelectorAll(".meteo-row");

            rows.forEach(function (row) {
                if (filter === "all" || row.getAttribute("data-station") === filter) {
                    row.style.display = "";
                } else {
                    row.style.display = "none";
                }
            });
        }
    </script>
    {% else %}
    <p>Aucune donn√©e disponible pour la station s√©lectionn√©e ou aucune donn√©e m√©t√©o n'a √©t√© trouv√©e.</p>
    {% endif %}

</body>

</html>